name: "Pull Request Labeler"

on:
  - pull_request_target

jobs:
  label_PR:
    permissions:
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    # This Job behaves as a Listener to PR events, and each step is a Handler
    steps:
      # HANDLER 1: Label PR, given file changes and Labeling Rules '.github/labeler.yml'
      - uses: actions/labeler@v5

      # checkout repo to Enable Handlers 2 and 3 to edit (write permission) PRs
      - name: Checkout Repository
        uses: actions/checkout@v4

      # HANDLER 2: Add 'boarding-auto' label to PR, if it targets 'boarding-auto' branch
      - name: "Label PR with 'boarding_auto' label"
        # WHEN PR  Head  -->  boarding-auto
        if: github.event_name == 'pull_request_target' && contains(github.event.pull_request.base.ref, 'boarding-auto')
        run: gh pr edit ${{ github.event.number }} --add-label 'boarding-auto'
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}

      # HANDLER 3: Enable PR 'Auto Merge', if it changes come from 'boarding-auto' branch
      - name: "Merge PR, Signaling what Automated Tests to run"
        # PR targeting 'boarding-auto' branch, needs to run CI Tests, given labels
        # WHEN PR  boarding-auto  -->  Base
        if:  startsWith(github.head_ref, 'boarding-auto')
        run: gh pr merge ${{ github.event.number }} --auto
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
